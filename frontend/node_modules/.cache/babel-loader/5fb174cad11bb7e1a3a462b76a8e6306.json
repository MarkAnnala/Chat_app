{"ast":null,"code":"var _jsxFileName = \"/Users/Mark/Documents/Skola/OSPP/adrenaline/frontend/src/components/Container/Container.js\";\nimport React, { useRef, useEffect } from \"react\";\nimport { BrowserRouter, Route, Switch, Redirect } from \"react-router-dom\";\nimport LandingPage from \"../LandingPage/LandingPage\";\nimport Login from \"../Login/Login\";\nimport Register from \"../Register/Register\";\nimport * as actions from \"../../actions/actions\";\nimport { useDispatch, useSelector } from \"react-redux\";\n/**\n * Container is the component that makes sure to route to specific component on start page\n * TODO more functionality when we can use user objects etc\n * @returns returns the actuall component that should be rendered depending on pathname\n */\n\nconst Container = () => {\n  /**\n   * HANDLING AND INITIALISATION OF WEBSOCKET EFFECTS\n   */\n  const ws = useSelector(state => state.socketState.socket);\n  /* used in useEffect to check if we need to refire useEffect() */\n\n  const wsOnline = useSelector(state => state.socketState.wsOnline);\n  /* used in useEffect to check if disconnect is by our own accord */\n\n  const url = useSelector(state => state.socketState.socketServer);\n  /* websocket url - will contain address when we call SETSERVER action */\n\n  const dispatch = useDispatch();\n  const loginResponse = useSelector(state => state.loginState.loginResponse);\n  /* used in useEffect to check if we need to refire useEffect() */\n\n  const username = useSelector(state => state.loginState.username);\n  /* used in useEffect to check if we need to refire useEffect() */\n  // used to keep a mutable ref object - in this case the websocket\n\n  const wsRef = useRef();\n  var firstWelcome = useSelector(state => state.socketState.firstWelcome); // Initiates the websocket client on mount (everything in useEffect is called on mount - like created/mounted in Vue)\n\n  useEffect(() => {\n    // if current prop of ref is null and ws url is set -> initialize new websocket connection (this happens first time)\n    if (!wsRef.current && url !== null) {\n      wsRef.current = new WebSocket(url);\n      dispatch(actions.connect(wsRef.current)); // add the ref to the redux store\n    }\n\n    if (wsRef.current != null) {\n      /* listening on messages received - response handled by the reducer?? */\n      wsRef.current.onmessage = msg => {\n        console.log(msg.data); //first time we need to establish an auth with server\n\n        if (firstWelcome === true) {\n          dispatch(actions.firstResponse({\n            action: \"login\",\n            username: username,\n            magictoken: loginResponse\n          }));\n          firstWelcome = false;\n        } else {\n          dispatch(actions.response(msg));\n        }\n      };\n      /* our websocket disconnected */\n\n\n      wsRef.current.onclose = () => {\n        if (wsOnline) {\n          /* trigger a reconnect */\n          console.log(\"reconnect to new ws\");\n          wsRef.current = new WebSocket(url);\n          dispatch(actions.connect(wsRef.current)); // add the ref to the redux store\n        } else {\n          /* disconnect the ws */\n          console.log(\"ws disconnected\");\n          dispatch(actions.disconnected(null));\n        }\n      };\n    }\n  }, [ws, url, username]);\n  /* dependency list includes ws - when ws is changed we refire the useEffect hook */\n\n  const loginSuccess = useSelector(state => state.loginState.loginSuccess);\n  return /*#__PURE__*/React.createElement(BrowserRouter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Switch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Route, {\n    path: \"/\",\n    exact: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }, loginSuccess ? /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 27\n    }\n  }) : /*#__PURE__*/React.createElement(Login, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 54\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }, loginSuccess ? /*#__PURE__*/React.createElement(LandingPage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 27\n    }\n  }) : /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 45\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(Route, {\n    path: \"/register\",\n    render: props => /*#__PURE__*/React.createElement(Register, Object.assign({}, props, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 52\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default Container;","map":{"version":3,"sources":["/Users/Mark/Documents/Skola/OSPP/adrenaline/frontend/src/components/Container/Container.js"],"names":["React","useRef","useEffect","BrowserRouter","Route","Switch","Redirect","LandingPage","Login","Register","actions","useDispatch","useSelector","Container","ws","state","socketState","socket","wsOnline","url","socketServer","dispatch","loginResponse","loginState","username","wsRef","firstWelcome","current","WebSocket","connect","onmessage","msg","console","log","data","firstResponse","action","magictoken","response","onclose","disconnected","loginSuccess","props"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect } from \"react\";\nimport { BrowserRouter, Route, Switch, Redirect } from \"react-router-dom\";\nimport LandingPage from \"../LandingPage/LandingPage\";\nimport Login from \"../Login/Login\";\nimport Register from \"../Register/Register\";\n\nimport * as actions from \"../../actions/actions\";\nimport { useDispatch, useSelector } from \"react-redux\";\n\n/**\n * Container is the component that makes sure to route to specific component on start page\n * TODO more functionality when we can use user objects etc\n * @returns returns the actuall component that should be rendered depending on pathname\n */\nconst Container = () => {\n  /**\n   * HANDLING AND INITIALISATION OF WEBSOCKET EFFECTS\n   */\n\n  const ws = useSelector(\n    (state) => state.socketState.socket\n  ); /* used in useEffect to check if we need to refire useEffect() */\n  const wsOnline = useSelector(\n    (state) => state.socketState.wsOnline\n  ); /* used in useEffect to check if disconnect is by our own accord */\n  const url = useSelector(\n    (state) => state.socketState.socketServer\n  ); /* websocket url - will contain address when we call SETSERVER action */\n  const dispatch = useDispatch();\n\n  const loginResponse = useSelector(\n    (state) => state.loginState.loginResponse\n  ); /* used in useEffect to check if we need to refire useEffect() */\n\n  const username = useSelector(\n    (state) => state.loginState.username\n  ); /* used in useEffect to check if we need to refire useEffect() */\n\n  // used to keep a mutable ref object - in this case the websocket\n  const wsRef = useRef();\n\n  var firstWelcome = useSelector((state) => state.socketState.firstWelcome);\n\n  // Initiates the websocket client on mount (everything in useEffect is called on mount - like created/mounted in Vue)\n  useEffect(() => {\n    // if current prop of ref is null and ws url is set -> initialize new websocket connection (this happens first time)\n    if (!wsRef.current && url !== null) {\n      wsRef.current = new WebSocket(url);\n      dispatch(actions.connect(wsRef.current)); // add the ref to the redux store\n    }\n\n    if (wsRef.current != null) {\n      /* listening on messages received - response handled by the reducer?? */\n      wsRef.current.onmessage = (msg) => {\n        console.log(msg.data);\n\n        //first time we need to establish an auth with server\n        if (firstWelcome === true) {\n          dispatch(\n            actions.firstResponse({\n              action: \"login\",\n              username: username,\n              magictoken: loginResponse,\n            })\n          );\n          firstWelcome = false;\n        } else {\n          dispatch(actions.response(msg));\n        }\n      };\n\n      /* our websocket disconnected */\n      wsRef.current.onclose = () => {\n        if (wsOnline) {\n          /* trigger a reconnect */\n          console.log(\"reconnect to new ws\");\n          wsRef.current = new WebSocket(url);\n          dispatch(actions.connect(wsRef.current)); // add the ref to the redux store\n        } else {\n          /* disconnect the ws */\n          console.log(\"ws disconnected\");\n          dispatch(actions.disconnected(null));\n        }\n      };\n    }\n  }, [\n    ws,\n    url,\n    username,\n  ]); /* dependency list includes ws - when ws is changed we refire the useEffect hook */\n\n  const loginSuccess = useSelector((state) => state.loginState.loginSuccess);\n\n  return (\n    <BrowserRouter>\n      <Switch>\n        <Route path=\"/\" exact>\n          {loginSuccess ? <Redirect to=\"/start\" /> : <Login />}\n        </Route>\n        <Route path=\"/start\">\n          {loginSuccess ? <LandingPage /> : <Redirect to=\"/\" />}{\" \"}\n        </Route>\n        <Route path=\"/register\" render={(props) => <Register {...props} />} />\n      </Switch>\n    </BrowserRouter>\n  );\n};\n\nexport default Container;\n"]},"metadata":{},"sourceType":"module"}